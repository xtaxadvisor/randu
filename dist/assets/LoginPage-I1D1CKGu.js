import{s as e,u as t,j as s,B as a,I as r}from"./index-D3F6h_Dx.js";import{r as n,u as i,d as o,L as l}from"./vendor-react-CtOH9B0J.js";import{z as c,p as d}from"./vendor-security-DSEDFEOr.js";import{y as u,s as m,z as h}from"./vendor-ui-BUyqawzT.js";import"./vendor-query-BtzKWVaK.js";const g={maxLoginAttempts:5,lockoutDuration:9e5,sessionTimeout:36e5,passwordMinLength:12,requireMFA:!1},p={windowMs:9e5,maxRequests:100};class w{constructor(){this.requests=new Map}static getInstance(){return w.instance||(w.instance=new w),w.instance}checkLimit(e){const t=Date.now(),s=t-p.windowMs;let a=this.requests.get(e)||[];return a=a.filter((e=>e>s)),!(a.length>=p.maxRequests)&&(a.push(t),this.requests.set(e,a),!0)}getRemainingRequests(e){const t=this.requests.get(e)||[];return Math.max(0,p.maxRequests-t.length)}clearRequests(e){this.requests.delete(e)}}const x=w.getInstance();class y{constructor(){this.logs=[]}static getInstance(){return y.instance||(y.instance=new y),y.instance}log(e){const t={...e,timestamp:new Date};this.logs.push(t),this.sendToServer(t).catch(console.error)}async sendToServer(e){try{await fetch("/.netlify/functions/audit-log",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})}catch(t){console.error("Failed to send audit log:",t)}}getLogs(e){let t=[...this.logs];return e&&(e.userId&&(t=t.filter((t=>t.userId===e.userId))),e.action&&(t=t.filter((t=>t.action===e.action))),e.resource&&(t=t.filter((t=>t.resource===e.resource))),e.startDate&&(t=t.filter((t=>t.timestamp>=e.startDate))),e.endDate&&(t=t.filter((t=>t.timestamp<=e.endDate)))),t}}const f=y.getInstance();c.string().email().min(5).max(255),c.string().min(g.passwordMinLength).regex(/[A-Z]/,"Must contain uppercase letter").regex(/[a-z]/,"Must contain lowercase letter").regex(/[0-9]/,"Must contain number").regex(/[^A-Za-z0-9]/,"Must contain special character"),c.string().min(2).max(100),c.string().regex(/^\+?[\d\s-()]+$/).min(10).max(20).optional(),c.string().url().max(2048).optional();const v=class{static async signIn(t,s){var a,r;try{const n=(r=t.toLowerCase().trim(),"undefined"==typeof window?r:d.sanitize(r,{ALLOWED_TAGS:[],ALLOWED_ATTR:[],SANITIZE_DOM:!0,USE_PROFILES:{html:!1}})),i="client-ip";if(!x.checkLimit(`login:${i}`))throw new Error("rate_limit_exceeded");const{data:o,error:l}=await e.auth.signInWithPassword({email:n,password:s});return l?(this.handleAuthError(l),null):(f.log({userId:(null==(a=o.user)?void 0:a.id)||"unknown",action:"login",resource:"auth",details:{email:n},ipAddress:i,userAgent:navigator.userAgent}),this.retryCount=0,o)}catch(n){return this.handleAuthError(n),null}}static handleAuthError(e){const s={invalid_credentials:"Invalid email or password. Please check your credentials and try again.",invalid_grant:"Invalid email or password. Please check your credentials and try again.",user_not_found:"No account found with this email address.",email_taken:"An account with this email already exists.",weak_password:"Password must be at least 12 characters long and include uppercase, lowercase, numbers, and special characters.",rate_limit_exceeded:"Too many attempts. Please try again in a few minutes.",expired_token:"Your session has expired. Please sign in again.",invalid_token:"Invalid authentication token. Please sign in again."}[e.message]||e.message||"An unexpected error occurred";if(t.getState().addNotification(s,"error"),f.log({userId:"unknown",action:"login_failed",resource:"auth",details:{error:e.message},ipAddress:"client-ip",userAgent:navigator.userAgent}),"rate_limit_exceeded"===e.message&&this.retryCount<this.MAX_RETRIES){this.retryCount++;const e=Math.min(1e3*Math.pow(2,this.retryCount-1),1e4);setTimeout((()=>this.retryCount=0),e)}}static async validateSession(){const{data:{session:t}}=await e.auth.getSession();if(!t)return!1;return Date.now()-new Date(t.created_at).getTime()<g.sessionTimeout}};v.MAX_RETRIES=3,v.retryCount=0;let A=v;function _(){var e,c;const[d,g]=n.useState({email:"",password:""}),[p,w]=n.useState(!1),x=i(),y=o(),{addNotification:f}=t(),v=(null==(c=null==(e=y.state)?void 0:e.from)?void 0:c.pathname)||"/dashboard";return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:s.jsxs("div",{className:"max-w-md w-full space-y-8",children:[s.jsxs("div",{children:[s.jsx(a,{variant:"ghost",className:"mb-4",onClick:()=>x("/"),icon:u,children:"Back to Home"}),s.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Sign in to your account"}),s.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Or"," ",s.jsx(l,{to:"/register",className:"font-medium text-blue-600 hover:text-blue-500",children:"create a new account"})]})]}),s.jsxs("form",{className:"mt-8 space-y-6",onSubmit:async e=>{if(e.preventDefault(),(()=>{if(e=d.email,!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(e.trim()))return f("Please enter a valid email address","error"),!1;var e;const t=function(e){const t=[];return e.length<8&&t.push("Password must be at least 8 characters long"),/[A-Z]/.test(e)||t.push("Password must contain at least one uppercase letter"),/[a-z]/.test(e)||t.push("Password must contain at least one lowercase letter"),/[0-9]/.test(e)||t.push("Password must contain at least one number"),/[!@#$%^&*(),.?":{}|<>]/.test(e)||t.push("Password must contain at least one special character"),{isValid:0===t.length,errors:t}}(d.password);return!!t.isValid||(f(t.errors[0],"error"),!1)})()){w(!0);try{await A.signIn(d.email,d.password)&&(f("Successfully logged in","success"),x(v,{replace:!0}))}catch(t){console.error("Sign in error:",t)}finally{w(!1)}}},children:[s.jsx(r,{id:"email",type:"email",label:"Email address",icon:m,value:d.email,onChange:e=>g({...d,email:e.target.value}),required:!0,autoComplete:"email",placeholder:"Email address",disabled:p}),s.jsx(r,{id:"password",type:"password",label:"Password",icon:h,value:d.password,onChange:e=>g({...d,password:e.target.value}),required:!0,autoComplete:"current-password",placeholder:"Password",disabled:p}),s.jsx(a,{type:"submit",variant:"primary",className:"w-full",disabled:p,children:p?"Signing in...":"Sign in"})]})]})})}function j(){return s.jsx("div",{className:"min-h-screen bg-gray-50",children:s.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:s.jsx(_,{})})})}export{j as default};
